<dialog id="{{ 'modal_blog_comments' }}" class="modal">
  <div class="modal-box w-9/12 max-w-xl max-h-11/12">
    <!-- X BUTTON -->
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
        <i class="material-symbols-outlined !text-xl">close</i>
      </button>
    </form>

    <h2 class="text-lg font-semibold">Comments of "{{ blogService.selectedBlog.blog.title }}"</h2>

    <div class="min-h-40">

      @if (blog.isLoading()) {
        <div class="flex justify-center p-4">
          <span class="loading loading-spinner loading-lg text-primary"></span>
        </div>
      } @else if (blog.error()) {
        <div class="alert alert-error mt-4">
          <i class="material-symbols-outlined !text-xl">error</i>
          <span
          >Error al cargar los comentarios. Por favor intenta de nuevo.</span
          >
          <button class="btn btn-sm" (click)="reload()">
            Retry
          </button>
        </div>
      } @else {
        <ul class="list">
          @for (comment of blog.value()?.comments; track comment; ) {
            <blog-comment
              [comment]="comment"
              [commentParentId]="null"
            ></blog-comment>
          }
          <li class="list-row p-0">
            <modal-open-button
              [modalName]="'modal_blog_comment'"
              [classes]="'btn btn-ghost btn-link'"
              (click)="commentService.selectedComment = {
                id: 0,
                content: '',
                blogId: blogService.selectedBlog.blog.id,
                commentParentId: null,
              }"
            >
              + Add a comment
            </modal-open-button>
          </li>
        </ul>
      }
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<app-dialog
  [title]="'Delete blog'"
  [message]="'Are you sure you want to delete this blog?'"
  [modalName]="'modal_blog_comment_delete'"
  [buttonText]="'Delete'"
  (callback)="deleteComment()"
></app-dialog>

<blog-comment-modal (reload)="reload()" />
